<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Survey Data Analysis</title>
    <meta charset="utf-8" />
    <meta name="date" content="2021-12-01" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <script src="libs/htmlwidgets/htmlwidgets.js"></script>
    <link href="libs/datatables-css/datatables-crosstalk.css" rel="stylesheet" />
    <script src="libs/datatables-binding/datatables.js"></script>
    <script src="libs/jquery/jquery-3.6.0.min.js"></script>
    <link href="libs/dt-core/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="libs/dt-core/css/jquery.dataTables.extra.css" rel="stylesheet" />
    <script src="libs/dt-core/js/jquery.dataTables.min.js"></script>
    <link href="libs/crosstalk/css/crosstalk.min.css" rel="stylesheet" />
    <script src="libs/crosstalk/js/crosstalk.min.js"></script>
    <script src="https://use.fontawesome.com/5235085b15.js"></script>
    <link rel="stylesheet" href="unhcr-slides.css" type="text/css" />
    <link rel="stylesheet" href="unhcr-slides-fonts.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Survey Data Analysis
## <code>&lt;font color=“black”, size = 30&gt;Cookbook</font></code>
### 
### 1 December 2021

---

layout: true

&lt;div class="my-footer"&gt;&lt;span&gt;&lt;/span&gt;&lt;/div&gt; 






---
class: inverse, left, middle

# A Vision for Data Analysis

&lt;span style='font-size:50px; color:grey15;'&gt;"_Multi-functional teams, with strengthened data literacy, regularly conduct meaningful and documented joint data interpretation sessions to define their strategic directions based on statistical evidences_"&lt;/span&gt;


???
Slides made with Xaringan - - https://arm.rbind.io/slides/xaringan.html
https://slides.earo.me/rladiesakl20/#1
https://xaringantutorial.netlify.app

---

# A Theory of Change for Data analysis

&lt;span style='font-size:30px;'&gt;Proper use of data for advocacy &amp; programmatic decision making &lt;/span&gt;

 &lt;span style='font-size:40px;'&gt;&amp;#8618;&lt;/span&gt; Corporate __Standards__ exist to define how to encode &amp; process household surveys dataset

 &lt;span style='font-size:40px;'&gt;&amp;#8618;&lt;/span&gt; Field data experts are trained based on precise recipes and predefined tools at each step of the __data life cycle__


 &lt;span style='font-size:40px;'&gt;&amp;#8618;&lt;/span&gt; Data are presented, discussed and linked to expert knowledge during data __interpretation__ sessions with a multi-functional team


 &lt;span style='font-size:40px;'&gt;&amp;#8618;&lt;/span&gt; All potential valid interpretations, including diverging views, are systematically __recorded__

 &lt;span style='font-size:40px;'&gt;&amp;#8618;&lt;/span&gt;  __Persuasive__ "Data Stories“ and Policy papers are generated

---

class: left, middle

# Learning objectives

### 1. How to build charts quickly?

### 2. How to calculate impact indicators from survey data? 

### 3. How to answer Key Research Questions? Describe...

_Explore, Explain to be presented in next webinar!_



???
Depending on the pace of the group, if we do not finish today we will org anise a second session 

---

# Webinar rules

&lt;i class="fa fa-spinner fa-spin fa-fw fa-2x"&gt;&lt;/i&gt; Leverage this opportunity and make this session __lively__ - there's no stupid questions!

&lt;i class="fa fa-check-square fa-fw fa-2x"&gt;&lt;/i&gt; Use the __chat__ to send your questions - we are two facilitators and one is focused on replying all questions directly in the chat while the session is on-going

&lt;i class="fa fa-cog fa-fw fa-2x"&gt;&lt;/i&gt; All practical exercises are designed to get you __testing the commands__:

&gt; Start Rstudio if you have already it installed  or Login now to[cloud-based version of RStudio](https://login.rstudio.cloud/register?redirect=https%3A%2F%2Fclient.login.rstudio.cloud%2Foauth%2Flogin%3Fshow_auth%3D0%26show_login%3D0) for this session  
    
&gt; Paste the command from the chat to your online Rstudio session and check what is happening
    
&gt; In case it is not working as expected, share screenshot or error messages from the console in the chat


---

# Click-based Workflow...


.pull-left[

Associate data  with other tables with **ACCESS** ![](images/Logo_Microsoft_Access_2013.png)

...then explore through graphs with **EXCEL** ![](images/Microsoft_Excel_2013_logo.svg.png) 

...then mapping with **ArcGIS** ![](images/ArcGIS.png)

]

.pull-right[

..then write up narratives in **WORD** ![](images/Microsoft_Word_logo.png) 

... and design a full document with **INDESIGN** ![](images/Adobe_InDesign_icon.png)

... or create an infographic with **ILLUSTRATOR** ![](images/Adobe_Illustrator_icon.png)
]



???
and eventually some VBA macros 

---

## ... coming up with challenges! 

As a coauthor/reader/peer reviewer, one would like to see the whole **research process** (_how we arrived to that conclusion_), rather than cooked manuscript with inserted tables/figures.


.pull-left[

What analysis is **behind the figure**? Did it accounts for [..._new last minute question_...] in the analysis? 
 
What **dataset** (_final vs preliminary version_) was used ? Were **outliers** identified? How did you **weight** your sample?

Oops, there is an error in the data. Can we **repeat the analysis**? And update quickly the figures, graphs and tables in the report and the presentation! 
]

.pull-right[
&gt; This consumes time and open space for errors...

![](images/exhausted.png)
]


???

When managing numerous analysis with data that may change and in a collaborative mode, this workflow is **not** the most effective. 

 *  Data are manipulated through "point-and-click" user interfaces that are not __captured__!
 *  Data are moving from a software to another (Excel, GIS, Word...) using different __formats__! 
 *  All results (figures, tables) are **manually** copied/pasted to the final publishing system...
 
---


# Science is '_show me_' - not '_trust me_'!

### Reproducible Research Manisfesto; aka the _"Ten Commandments"_ 

.pull-left[

For every result, **keep track** of how it was produced

**Avoid manual data manipulation** steps

**Archive** the exact versions of all external programs used

**Version control** all custom scripts

**Record all intermediate results**, when possible in standardized formats
]

.pull-right[

For analyses that include randomness, **note underlying random seeds**

Always **store raw data** behind plots

Generate hierarchical analysis output, allowing layers of increasing detail to be inspected

Connect **textual statements** to underlying results

Provide **public access** to scripts, runs, and results
]

---

## Enable a fully auditable workflow

As soon as all steps (i.e. **DATA + TIDYING + MODELING + VISUALS + NARRATIVE**) are done through **series of written commands recorded in scripts**:

 - when spotting error in the data, or using different dataset, one just need to adjust in the script and report will update automatically;
 
 - Data manipulation becomes be *de facto* fully documented (no more manual changes in Excel);

 - Analysis is self-explanatory and ready for any kind of collaborative review;

 - Customization are facilitated and allow to deliver  final product  with a professional branding and styling.
 

 
&gt; Analysis becomes streamlined and [reproducible](https://unhcr-americas.github.io/reproducibility)! 

&gt; A "collaboration mode" is enabled from the begining of the process! 

&gt; As your analysis can be reviewed, you become "covered"... 

???
 instead of **hundreds of mouse clicks**
See also http://muschellij2.github.io/summerR_2015/modules/module12.html
---

### Key Concept 1: From "click" to "script"

Using the right combination of packages, you can integrate all necessary data analysis steps into **scripts**:

.pull-left[

Data management (import, clean, recode, merge, reshape)

Data analysis (test, regression, multivariate analysis, etc...)
 
Data visualization (plot, map, graph...)

Writing up results (report and presentation generation)

]

.pull-right[

![](images/data-science-wrangle.png)

]


 

---


### Key Concept 2: Everything is an object &amp; Anything can be packaged....


.left-column[


![](images/design-cake3.png)


]

.right-column[


`Vectors` are a core single data structure, created with `c()`. 

`Data.frame` where each column is a vector, but adjacent vectors can hold different things

`Matrix` just like a data frame except it's all numeric

`List` are made of any dimension, mix and match

`Factors` are a special class that R uses for categorical variables, which also allows for value labeling and ordering.

`Functions` are object designed to transform one object in a new one

`Charts` are objects  designed to generate an image

`Models` are objects recording computation based on specific data 

]


???
Elements in a vector must be of the same type.
Reference link on [Manipulating data](http://www.cookbook-r.com/Manipulating_data/)


---


### Key Concept 3: Search, Test, Try...

.pull-left[

![](images/change.png)
]

.pull-right[

Get a Certification on R language recognized by UNHCR on [learn.unhcr.org](https://unhcr.csod.com/ui/lms-learner-playlist/PlaylistDetails?playlistId=e90e2279-e3a4-4ef2-8b74-757f91d224b2) and play with [Rstudio Primers](https://rstudio.cloud/learn/primers)

Search and ask in [Stackoverflow](https://stackoverflow.com/questions/tagged/r)

Go through [Cheat-sheets](https://rstudio.cloud/learn/cheat-sheets)

Consult Key Manuals, maybe starting with [R for Data Science](https://r4ds.had.co.nz/)

Browse chart library on [`UnhcrDataPackage`]() 

Follow blogs like general [Rbloggers](https://www.r-bloggers.com/), [Tidyverse blog](https://www.tidyverse.org/blog/) or more specific [HumanitaRian-useR-group](https://humanitarian-user-group.github.io/) as well some twitter accounts.

Join forum like [Inter-Agency R skype group](https://join.skype.com/qYBKC5q3wKp4) or Internal UNHCR Ms Discussion group (ask to join!).

]

---


# Learning stages...

.pull-left[

![](images/learning.png)
]

.pull-right[

 __Step 1.__ Develop an understanding of what data science is and what programming and math concepts are needed for it
 
 __Step 2.__ Break data science challenges into small steps - Acquire basic command syntax through very practical and focused project
 
 __Step 3.__ Develop Reproducible Analysis Workflow - Understand the relevance, inputs, constraints, and limitations of the various techniques
 
 __Step 4.__ Optimize your problem solving approaches in elegant ways - Build packages

]

???
https://towardsdatascience.com/the-stages-of-learning-data-science-3cc8be181f54 

See Video - https://www.youtube.com/watch?v=hpMc6TgT34I 

---
# Analytics Models / Algorithms


![](images/analytics.png)
---
class: center, middle, inverse

# Practical Use Case 1 - Charting

### *My boss needs a slide with the main origin of Asylum Seekers and Refugees from Americas in this country... in 5 minutes....* &lt;i class="fa fa-exclamation-circle fa-fw fa-2x"&gt;&lt;/i&gt; 


---

## How to get to this chart in a couple of lines?

&lt;img src="presentation1_files/figure-html/unnamed-chunk-1-1.png" width="80%" /&gt;

???
https://r4ds.had.co.nz/graphics-for-communication.html#figure-sizing 

---

### Install required packages

Got to your [locally installed Rstudio](https://www.rstudio.com/products/rstudio/download/#download) or [sign-up for a free Rstudio Cloud account](https://login.rstudio.cloud/register?redirect=https%3A%2F%2Fclient.login.rstudio.cloud%2Foauth%2Flogin%3Fshow_auth%3D0%26show_login%3D0)

.pull-left[

First create a new project within R studio and then make sure we have the [tidyverse](https://www.tidyverse.org/packages/) plus additional UNHCR packages


```r
# Tidyverse
if (!require("tidyverse")) install.packages("tidyverse", dependencies = TRUE)
if (!require("here")) install.packages("here")

# UnhcRverse  
if (!require("unhcrdatapackage")) remotes::install_github('unhcr/unhcrdatapackage')
if (!require("unhcRstyle")) remotes::install_github('unhcr-web/unhcRstyle')
```
]

 
.pull-right[



![tidyverse](images/forcats.png)  


]

???

The tidyverse is an opinionated collection of R packages designed for data science. All packages share an underlying design philosophy, grammar, and data structures.



---

### Get the data

.pull-left[

To get the data, multiple approaches are possible. 

Go to [UNHCR dataset page on HDX](https://data.humdata.org/dataset/unhcr-population-data-for-world) to download the dataset: `end_year_population_totals_residing_world.csv` and save it locally within your project in a folder name `data-raw`


```r
popdata &lt;- read.csv(here::here("data-raw", "end_year_population_totals_residing_world.csv"))
```

or __save time__ and use directly the unhcrdatapackage that includes a reshaped `long` version of the data


```r
popdata &lt;- unhcrdatapackage::end_year_population_totals_long

## check the name of the variable
#names(popdata)

## Check the top 5 lines for select variables
# head(popdata %&gt;% select(Year, CountryOriginCode,CountryAsylumCode,Population.type, Value),5) 
```
]


--

.pull-right[

```
## [1] "Year"                        "CountryOriginCode"          
## [3] "CountryAsylumCode"           "CountryOriginName"          
## [5] "CountryAsylumName"           "Population.type"            
## [7] "Value"                       "Population.type.label"      
## [9] "Population.type.label.short"
```

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:right;"&gt; Year &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; CountryAsylumCode &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Population.type &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Value &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 1951 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; AUS &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; REF &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 180000 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 1951 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; AUT &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; REF &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 282000 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 1951 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; BEL &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; REF &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 55000 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 1951 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; CAN &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; REF &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 168511 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 1951 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; DNK &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; REF &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2000 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
]

---

### Reshape the data  - 1 - Merge with reference

.pull-left[

```r
# first merge it with the reference table to get the bureau filter 
#names(unhcrdatapackage::reference)
*Origin &lt;- dplyr::left_join(
  x= unhcrdatapackage::end_year_population_totals_long, 
  y= unhcrdatapackage::reference, 
  by = c("CountryAsylumCode" = "iso_3"))   


# head(names(unhcrdatapackage::reference), 9)
#knitr::kable(head(unhcrdatapackage::reference %&gt;% select(UNHCRBureau,iso_3, ctryname )%&gt;% filter(UNHCRBureau== "Americas" ),   5), format = 'html')
```
]

--

.pull-right[

```
## [1] "iso_3"       "UNHCRcode"   "ctryname"    "namepostat"  "namepostat2"
## [6] "gis_name"    "UNHCRBureau" "main_office" "hcr_region"
```

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; UNHCRBureau &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; iso_3 &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; ctryname &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Americas &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; ABW &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Aruba &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Americas &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; AIA &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Anguilla &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Americas &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; ARG &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Argentina &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Americas &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; ASM &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; American Samoa &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Americas &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; ATG &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Antigua and Barbuda &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
]

---

### Reshape the data - 2 - Filter



```r
nrow(Origin) # Number of Rows before filter
```

```
# [1] 161788
```

```r
## Using Pipe (%&gt;%) Operator
# allows us to pass the result of one function/argument to the other one in sequence
# assigning each functional output as an argument to the next one, and so on
Origin &lt;- Origin %&gt;%
  
* ## First handling functions..
* filter(
  # Other handling functions includes: 
  # arrange, at_least, chop, combine, dissolve, filter, 
  # mutate, rename, rm_uncomplete, rw_fac, sample_frac,
  # sample_n, select, slice, subset.Coo
  ## https://dplyr.tidyverse.org/reference/index.html
    
    ## we will use the 4 filters below
    CountryAsylumName  == "Panama" &amp; 
    UNHCRBureau == "Americas" &amp;
    Year == max(unhcrdatapackage::end_year_population_totals_long$Year) &amp;
    Population.type  %in%c("REF", "ASY", "VDA" ))


nrow(Origin) # Checking Number of rows after filter
```

```
# [1] 46
```



---

### Reshape the data - 3 - Shorten country name



```r
## Check what the potential value of CountryOriginName
levels(Origin$CountryOriginName)
```

```
# NULL
```

```r
## Changing to factor an display the last 10 values
tail(levels(as.factor(Origin$CountryOriginName)),6)
```

```
# [1] "Sierra Leone"                       "Somalia"                           
# [3] "Sri Lanka"                          "Sudan"                             
# [5] "Ukraine"                            "Venezuela (Bolivarian Republic of)"
```

```r
Origin &lt;- Origin %&gt;%  
* mutate(
    CountryOriginName = str_replace(CountryOriginName,
                                    " \\(Bolivarian Republic of\\)", "")) 
## We used a string replacement function

## check replacement 
tail(levels(as.factor(Origin$CountryOriginName)),4)
```

```
# [1] "Sri Lanka" "Sudan"     "Ukraine"   "Venezuela"
```


---


### Reshape the data - 4 - Aggregate by Country of Origin

.pull-left[

```r
Origin &lt;- Origin %&gt;%  
* group_by( CountryOriginName) %&gt;%
* summarise(DisplacedAcrossBorders = sum(Value) )


### Explore the results in a filterable table
# DT::datatable(Origin,
#    fillContainer = FALSE, options = list(pageLength = 4))
```
]

--

.pull-right[
<div id="htmlwidget-76abda4bc4c140a3aef8" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-76abda4bc4c140a3aef8">{"x":{"filter":"none","vertical":false,"fillContainer":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35"],["Afghanistan","Armenia","Bangladesh","Belarus","Bosnia and Herzegovina","Cameroon","Colombia","Côte d'Ivoire","Croatia","Cuba","Democratic Republic of the Congo","Dominican Republic","Ecuador","El Salvador","Eritrea","Guatemala","Haiti","Honduras","India","Iran (Islamic Republic of)","Italy","Jamaica","Liberia","Mexico","Nepal","Nicaragua","Nigeria","Pakistan","Peru","Sierra Leone","Somalia","Sri Lanka","Sudan","Ukraine","Venezuela"],[11,5,15,7,5,14,2745,5,5,1674,5,5,15,1315,38,20,19,94,7,5,5,5,5,5,14,5409,44,16,23,5,101,7,5,5,124384]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>CountryOriginName<\/th>\n      <th>DisplacedAcrossBorders<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":4,"columnDefs":[{"className":"dt-right","targets":2},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[4,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
]

---


### Reshape the data - 5 - Create data labels

.pull-left[

```r
Origin &lt;- Origin %&gt;%  
  
* ## using the scales::label_number_si function
  ## but adding some accuracy needs to be corrected for values below 1000
  mutate( DisplacedAcrossBordersRound =  
            ## let do a test with ifelse
            ifelse(DisplacedAcrossBorders &gt; 1000, 
            ## condition 1 - above 1000
            paste(scales::label_number_si(accuracy = 0.1)(DisplacedAcrossBorders)),
            ## condition 2 - below 1000
            as.character(DisplacedAcrossBorders) ) ) 
```
]

--

.pull-right[
&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; CountryOriginName &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; DisplacedAcrossBordersRound &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Venezuela &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 124.4K &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Nicaragua &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 5.4K &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Colombia &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 2.7K &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Cuba &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1.7K &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; El Salvador &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1.3K &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Somalia &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 101 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Honduras &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 94 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Nigeria &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 44 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Eritrea &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 38 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Peru &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 23 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
]

---


### Reshape the data - 6 - Select top 10 countries

.pull-left[

```r
Origin &lt;- Origin %&gt;%  
  ## Sorting resulting by descending numbers
  arrange(desc(DisplacedAcrossBorders)) %&gt;%
  ## keep only the first 10 records
  head(10)

## check results
#knitr::kable(head(Origin %&gt;%
#    select(CountryOriginName,DisplacedAcrossBordersRound ),5 ), format = 'html')
```
]

--

.pull-right[
&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; CountryOriginName &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; DisplacedAcrossBordersRound &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Venezuela &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 124.4K &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Nicaragua &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 5.4K &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Colombia &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 2.7K &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Cuba &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1.7K &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; El Salvador &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1.3K &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
]

---

### Build the chart - 1 - Initial bar plot

.pull-left[



```r
## A chart is indeed an object

## We create below a chart called plot using the basic ggplot function

plot &lt;- ggplot(data = Origin, 
               
               ## Construct aesthetic mappings of variables to the chart
               aes(
                 # Reordering country name by Value to avoid default alphabetical
                 x = reorder(CountryOriginName, DisplacedAcrossBorders), 
                 y = DisplacedAcrossBorders)) +
  
  # here we configure that it will be bar chart    
  geom_bar(
           stat = "identity", 
## indicate how data should be summarised... 
# default behavior is to count the rows for each x value # stat = "identity" tells ggplot2 to skip aggregation
# An alternative is to use geom_col
## indicate the color to use to fill the bar 
           fill = "#0072bc")  

## Print the plot!!
plot
```

]

--

.pull-right[

&lt;img src="presentation1_files/figure-html/unnamed-chunk-18-1.png" width="1800" /&gt;

]


???
See full reference here https://ggplot2.tidyverse.org/reference/

---

### Build the chart - 2 - Format axis number


.pull-left[


```r
## A plot is constructed through layered instruction - 
# I can re-use the same plot object (here: plot) and add more instructions with a +

plot &lt;- plot + 
  scale_y_continuous( label = scales::label_number_si())

## simply inputing the name of the object as a commend will print its status
plot
```

]

--

.pull-right[

&lt;img src="presentation1_files/figure-html/unnamed-chunk-20-1.png" width="1800" /&gt;

]

---

### Build the chart - 3 - Flip the chart

.pull-left[


```r
plot &lt;- plot + 
  coord_flip()

plot
```

]

--

.pull-right[

&lt;img src="presentation1_files/figure-html/unnamed-chunk-22-1.png" width="1800" /&gt;

]


---

### Build the chart - 4 - Add and position data label


.pull-left[


```r
plot &lt;- plot + 
  ## Add label inside the bar in white - outside bar in black
  geom_label( data = subset(Origin, DisplacedAcrossBorders &lt; max(DisplacedAcrossBorders) / 1.5),
              aes(x = reorder(CountryOriginName, DisplacedAcrossBorders), 
                  y = DisplacedAcrossBorders,
                  label= DisplacedAcrossBordersRound),
              hjust = -0.1 ,
              vjust = 0.5, 
              colour = "black", 
              fill = NA,  label.size = NA, 
              family = "Lato", size = 4   ) +  
    ## Add label outside bar in black 
  geom_label( data = subset(Origin, DisplacedAcrossBorders &gt;= max(DisplacedAcrossBorders) / 1.5),
              aes(x = reorder(CountryOriginName, DisplacedAcrossBorders), 
                  y = DisplacedAcrossBorders,
                  label= DisplacedAcrossBordersRound),
              hjust = 1.1 ,
              vjust = 0.5, 
              colour = "white", 
              fill = NA,  label.size = NA, 
              family = "Lato", size = 4   ) 
plot
```

]

--

.pull-right[

&lt;img src="presentation1_files/figure-html/unnamed-chunk-24-1.png" width="1800" /&gt;

]

---

### Build the chart - 5 - Add chart labels

.pull-left[


```r
plot &lt;- plot +  
  ## and the chart labels
  labs(title = "What are the main Origin of Forced Displacement across Borders?",
       subtitle = paste0("Top 10 Origin from Americas - Data as of ",max(unhcrdatapackage::end_year_population_totals_long$Year), "  in Panama" ), 
       x = " ",
       y = "# of Forcibly displaced people",
       caption = "Data: UNHCR Refugee Population Statistics Database.\n Forced Displacement includes Refugees, Asylym Seekers and Venezuelan Displaced Abroad Population Group.") 
plot
```

]

--

.pull-right[

&lt;img src="presentation1_files/figure-html/unnamed-chunk-26-1.png" width="1800" /&gt;

]

---

### Build the chart - 6 - Apply unhcRstyle

.pull-left[


```r
plot &lt;- plot +  
  unhcRstyle::unhcr_theme(base_size = 8)  
plot
```

]

--

.pull-right[

&lt;img src="presentation1_files/figure-html/unnamed-chunk-28-1.png" width="1800" /&gt;

]

---

### Build the chart - 7 - Adjust graphical element

.pull-left[


```r
plot &lt;- plot +  
  ## Hihlight axis line
  geom_hline(yintercept = 0, size = 1.1, colour = "#333333") +
  theme(
    ### changing grid line that should appear
    panel.grid.major.x = element_line(color = "#cbcbcb"),
    panel.grid.major.y = element_blank()) 
plot
```

]

--

.pull-right[

&lt;img src="presentation1_files/figure-html/unnamed-chunk-30-1.png" width="1800" /&gt;

]

---

# The Grammar of graphics in 7 key syntax

.img75[![Structure of ggplot2](images/struct_ggplot.png)]
[@CedSherer](https://twitter.com/CedScherer/status/1229418108122783744?s=20)

???
**Data**
- Data is not just data
- Representation defines what can be done with it
- Grammar requires a tidy format (though it precedes the notion) 

**Aesthetics**
- Allow generic datasets to be understood by the graphic system.
- Link variables in data to graphical properties in the geometry.

**Layers**
1. Geom
    - How to interpret aesthetics as graphical representations
    - Is a progression of positional aesthetics a number of points, a line, a single polygon, or something else entirely?
2. Stats
    - Transform input variables to displayed values
    - Is implicit in many plot-types but can often be done prior to plotting

**Scales**
- A scale translate back and forth between variable ranges and property ranges
    - Categories &gt; Colour
    - Numbers &gt; Position

**Coordinates**
- Defines the physical mapping of the aesthetics to the paper 

**Facets**
- Define the number of panels with equal logic and split data among them…
- Small multiples 

**Themes**
- Theming spans every part of the graphic that is not linked to data

---


.pull-left[

### Insert this in a slide deck -  Report template....

All based on Rmarkdown that allow to create multiple outputs from the same content format.

- Powerpoint with UNHCR style

- Word with UNHCR style

- html/bootstrap -scroll-able report

- html/slide - slide-able report (WIP)

- Paginated report built on the top of pagedown.

- Analysis Repository contribution


]

.pull-right[

Access them **"From Template"** panel when creating a new Rmd document

![UNHCR Rmd templates](images/rmd_templates.png)

]



---
class: center, middle, inverse


# Practical Use Case 2 - Building impact indicators from Survey Data

### *The National Household Survey is including Forcibly Displaced People and got published yesterday... We need to report our indicators by tomorrow!  * &lt;i class="fa fa-exclamation-triangle fa-fw fa-2x"&gt;&lt;/i&gt; 


???



We will use the “Encuesta Nacional de Calidad de Vida ECV 2020” published by the National Office of Colombia (http://microdatos.dane.gov.co/index.php/catalog/718/get_microdata) and explore different type of statistical analysis based on an example of three research questions:


---

## How to get to this chart in a couple of lines?

&lt;img src="presentation1_files/figure-html/unnamed-chunk-31-1.png" width="80%" /&gt;


---


### Install packages

The particularity of HH survey dataset, when stored in SPSS (`.sav`), SAS (`.sas7bdat`), or Stata (`.dta`) format is that they usually contains both values and __associated labels__ (we call them `labelled data`).

.pull-left[


```r
if (!require("haven")) install.packages("haven", dependencies = TRUE) 
if (!require("labelled")) install.packages("labelled", dependencies = TRUE)
if (!require("sjPlot")) install.packages("sjPlot", dependencies = TRUE)
if (!require("DT")) install.packages("DT", dependencies = TRUE)
```
]

--

.pull-right[
![tidyverse](images/labelled_preview.PNG)  

]

???
https://www.pipinghotdata.com/posts/2020-12-23-leveraging-labelled-data-in-r/ 

---


### Get the data


The dataset,  [Encuesta Nacional de Calidad de Vida ECV 2020, Colombia, DANE](http://microdatos.dane.gov.co/index.php/catalog/718/get_microdata) is available through a micro data library.  Download the data from [here]( https://unhcr365-my.sharepoint.com/:f:/g/personal/legoupil_unhcr_org/El_KBosz8pFJilV0mSYUXycBhXqXx2dXtGey4T3_R1L8pA?e=kFXm5U) to your "`data-raw`" folder within your project file

.left-column[

```r
##  Household composition where disaggregation variables are
data0 &lt;- haven::read_sav(here::here("data-raw", "Características y composición del hogar.sav"))

## Display frame content
# data0 %&gt;% 
#        sjPlot::view_df()

# view_df() offers many options, e.g. to add the frequencies of values, 
# the amount of missing values per variable, 
#or even weighted frequencies.
  # show.na = TRUE, 
  # show.type = TRUE, 
  # show.frq = TRUE, 
  # show.prc = TRUE, 
  # show.string.values = TRUE, 
  # show.id = TRUE 
```
]

--

.right-column[
&lt;table style="border-collapse:collapse; border:none;"&gt;
&lt;caption&gt;Data frame: .&lt;/caption&gt;
&lt;tr&gt;
&lt;th style="border-bottom:double; font-style:italic; font-weight:normal; padding:0.2cm; text-align:left; vertical-align:top;"&gt;ID&lt;/th&gt;&lt;th style="border-bottom:double; font-style:italic; font-weight:normal; padding:0.2cm; text-align:left; vertical-align:top;"&gt;Name&lt;/th&gt;&lt;th style="border-bottom:double; font-style:italic; font-weight:normal; padding:0.2cm; text-align:left; vertical-align:top;"&gt;Label&lt;/th&gt;&lt;th style="border-bottom:double; font-style:italic; font-weight:normal; padding:0.2cm; text-align:left; vertical-align:top;"&gt;Values&lt;/th&gt;&lt;th style="border-bottom:double; font-style:italic; font-weight:normal; padding:0.2cm; text-align:left; vertical-align:top;"&gt;Value Labels&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;1&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;DIRECTORIO&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;Directorio&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;" colspan="2"&gt;&lt;em&gt;range: 7247300-7407013&lt;/em&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;2&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;SECUENCIA_ENCUESTA&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;Secuencia_encuesta&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee" colspan="2"&gt;&lt;em&gt;range: 1-22&lt;/em&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;3&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;SECUENCIA_P&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;Secuencia_p&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;" colspan="2"&gt;&lt;em&gt;range: 1-4&lt;/em&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;4&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;ORDEN&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;Orden&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee" colspan="2"&gt;&lt;em&gt;range: 1-22&lt;/em&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;5&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;FEX_C&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;Factor de expansión&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;" colspan="2"&gt;&lt;em&gt;range: 1.9-3061.6&lt;/em&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;6&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;P6016&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;Número de orden de la persona que proporciona la&lt;br&gt;información:&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee" colspan="2"&gt;&lt;em&gt;range: 1-18&lt;/em&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;7&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;P1894&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;Tipo de documento de identidad&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;1&lt;br&gt;2&lt;br&gt;3&lt;br&gt;4&lt;br&gt;5&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;Registro civil de nacimiento&lt;br&gt;Tarjeta de identidad&lt;br&gt;Cédula de ciudadanía&lt;br&gt;Cédula de extranjería&lt;br&gt;No tiene documento de identidad&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;8&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;P6020&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;Sexo&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;1&lt;br&gt;2&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;Hombre&lt;br&gt;Mujer&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;9&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;P6034&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;¿Cuál es la fecha de nacimiento de _____?&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;" colspan="2"&gt;&lt;em&gt;range: 1-2&lt;/em&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;10&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;P6040&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;¿cuántos años cumplidos tiene...?&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee" colspan="2"&gt;&lt;em&gt;range: 0-106&lt;/em&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;11&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;P6051&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;Cuál es el parentesco de....con el jefe o la jefa&lt;br&gt;de este hogar?&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;1&lt;br&gt;2&lt;br&gt;3&lt;br&gt;4&lt;br&gt;5&lt;br&gt;6&lt;br&gt;7&lt;br&gt;8&lt;br&gt;9&lt;br&gt;10&lt;br&gt;11&lt;br&gt;12&lt;br&gt;13&lt;br&gt;14&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;Jefe (a) del hogar&lt;br&gt;Pareja, esposo (a), cónyuge, compañero(a)&lt;br&gt;Hijo(a) hijastro(a)&lt;br&gt;Nieto (a)&lt;br&gt;Padre, madre, padrastro y madrastra&lt;br&gt;Suegro o suegra&lt;br&gt;Hermano (a), hermanastro (a)&lt;br&gt;Yerno, nuera&lt;br&gt;Otro pariente del jefe(a)&lt;br&gt;Empleado(a) del servicio doméstico&lt;br&gt;Parientes del servicio doméstico&lt;br&gt;Trabajador&lt;br&gt;Pensionista&lt;br&gt;Otro pariente&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;12&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;P5502&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;Actualmente…:&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;1&lt;br&gt;2&lt;br&gt;3&lt;br&gt;4&lt;br&gt;5&lt;br&gt;6&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt; No está casado(a) y vive en pareja hace menos de dos años&lt;br&gt;No está casado(a) y vive en pareja hace dos años o más&lt;br&gt; Está viudo(a)&lt;br&gt;Está separado(a) o divorciado(a)&lt;br&gt; Está soltero(a)&lt;br&gt; Está casado(a)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;13&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;P6071&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;El (la) cónyuge de .. vive en este hogar&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;1&lt;br&gt;2&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;Sí&lt;br&gt;No&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;14&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;P6071S1&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;No de orden&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee" colspan="2"&gt;&lt;em&gt;range: 1-19&lt;/em&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;15&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;P756&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;¿Dónde nació  ________?&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;1&lt;br&gt;2&lt;br&gt;3&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;En este municipio&lt;br&gt;En otro municipio&lt;br&gt;En otro país&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;16&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;P756S1&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;Departamento&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee" colspan="2"&gt;&lt;em&gt;range: 5-99&lt;/em&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;17&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;P756S2&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;Municipio&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;" colspan="2"&gt;&lt;em&gt;range: 5001-99773&lt;/em&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;18&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;P756S3&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;En otro país&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;1&lt;br&gt;2&lt;br&gt;3&lt;br&gt;4&lt;br&gt;5&lt;br&gt;6&lt;br&gt;7&lt;br&gt;8&lt;br&gt;9&lt;br&gt;10&lt;br&gt;11&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;Estados Unidos&lt;br&gt;España&lt;br&gt;Venezuela&lt;br&gt;Ecuador&lt;br&gt;Panamá&lt;br&gt;Perú&lt;br&gt;Costa Rica&lt;br&gt;Argentina&lt;br&gt;Francia&lt;br&gt;Italia&lt;br&gt;Otro país&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;19&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;P6074&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;¿_______________ siempre ha vivido aquí en este&lt;br&gt;municipio?&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;1&lt;br&gt;2&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;Sí&lt;br&gt;No&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;20&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;P767&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;¿cuántos años continuos hace que vive ___ aquí en&lt;br&gt;este municipio?&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee" colspan="2"&gt;&lt;em&gt;range: 0-90&lt;/em&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;21&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;P6076&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;Antes de venir a este municipio_______________&lt;br&gt;vivía en&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;1&lt;br&gt;2&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;Otro país&lt;br&gt;Otro municipio&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;22&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;P6076S1&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;Departamento&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;23&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;P6076S2&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;Municipio
&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;24&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;P6077&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;_____ vivía en&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;1&lt;br&gt;2&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;El centro urbano donde está la alcaldía&lt;br&gt;Un corregimiento, inspección de policía, caserío, vereda o c&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;25&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;P6096&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;¿cuál fue la razón principal para cambiar la&lt;br&gt;residencia al municipio actual?&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;1&lt;br&gt;2&lt;br&gt;3&lt;br&gt;4&lt;br&gt;5&lt;br&gt;6&lt;br&gt;7&lt;br&gt;8&lt;br&gt;9&lt;br&gt;10&lt;br&gt;11&lt;br&gt;12&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt; Dificultad para encontrar trabajo o ausencia de medios de s&lt;br&gt; Riesgo o consecuencia de desastre natural (inundación, aval&lt;br&gt;Amenaza o riesgo para su vida, su libertad o su integridad f&lt;br&gt; Necesidad de educación&lt;br&gt;Porque se casó o formó pareja&lt;br&gt; Motivos de salud&lt;br&gt; Mejorar la vivienda o localización&lt;br&gt; Mejores oportunidades laborales o de negocio&lt;br&gt;Acompañar a otro(s) miembro(s) del hogar&lt;br&gt;Adquisición de vivienda&lt;br&gt;Búsqueda de tranquilidad o mejor calidad de vida&lt;br&gt; Otra&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;26&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;P6081&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;El padre de .. vive en este hogar&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;1&lt;br&gt;2&lt;br&gt;3&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;Sí&lt;br&gt;No&lt;br&gt;Fallecido&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;27&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;P6081S1&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;No. De orden&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;" colspan="2"&gt;&lt;em&gt;range: 1-15&lt;/em&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;28&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;P6087&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;¿cuál es o fue el nivel de educación más alto&lt;br&gt;alcanzado por el padre de…..?&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;1&lt;br&gt;2&lt;br&gt;3&lt;br&gt;4&lt;br&gt;5&lt;br&gt;6&lt;br&gt;7&lt;br&gt;8&lt;br&gt;9&lt;br&gt;10&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;Algunos años de primaria&lt;br&gt;Toda la primaria&lt;br&gt;Algunos años de secundaria&lt;br&gt;Toda la secundaria&lt;br&gt;Uno o mas años de técnica o tecnológica&lt;br&gt;Técnica o tecnológica completa&lt;br&gt;Uno o mas años de universidad&lt;br&gt;Universitaria completa&lt;br&gt;Ninguno&lt;br&gt;No sabe&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;29&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;P6083&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;La madre de .. vive en este hogar&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;1&lt;br&gt;2&lt;br&gt;3&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;Sí&lt;br&gt;No&lt;br&gt;Fallecida&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;30&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;P6083S1&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;No. De orden&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee" colspan="2"&gt;&lt;em&gt;range: 1-18&lt;/em&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;31&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;P6088&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;¿cuál es o fue el nivel de educación más alto&lt;br&gt;alcanzado por la madre de......?&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;1&lt;br&gt;2&lt;br&gt;3&lt;br&gt;4&lt;br&gt;5&lt;br&gt;6&lt;br&gt;7&lt;br&gt;8&lt;br&gt;9&lt;br&gt;10&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;Algunos años de primaria&lt;br&gt;Toda la primaria&lt;br&gt;Algunos años de secundaria&lt;br&gt;Toda la secundaria&lt;br&gt;Uno o mas años de técnica o tecnológica&lt;br&gt;Técnica o tecnológica completa&lt;br&gt;Uno o mas años de universidad&lt;br&gt;Universitaria completa&lt;br&gt;Ninguno&lt;br&gt;No sabe&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;32&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;P6080&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;De acuerdo con su cultura, pueblo o rasgos&lt;br&gt;físicos, _____ es o se reconoce comó:&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;1&lt;br&gt;2&lt;br&gt;3&lt;br&gt;4&lt;br&gt;5&lt;br&gt;6&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;Indígena&lt;br&gt;Gitano (a) (rom)&lt;br&gt;Raizal del background-color:#eeeeeehipiélago de San Andrés, Providencia y Santa C&lt;br&gt;Palenquero (a) de San Basilio&lt;br&gt;Negro (a), mulato (a) (afrodescendiente), afrocolombiano(a)&lt;br&gt;Ninguno de los anteriores&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;33&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;P5667&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt; ¿a cuál pueblo o etnia indígena pertenece _____?&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;34&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;P2057&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;¿Usted se considera campesino(a)?&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;1&lt;br&gt;2&lt;br&gt;3&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;Si&lt;br&gt;No&lt;br&gt;No informa&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;35&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;P2059&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt; ¿Usted considera que alguna vez fue campesino(a)?&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;1&lt;br&gt;2&lt;br&gt;3&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;Si&lt;br&gt;No&lt;br&gt;No informa&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;36&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;P2061&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt; ¿Usted considera que la comunidad en que vive es&lt;br&gt;campesina?&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;1&lt;br&gt;2&lt;br&gt;3&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;Si&lt;br&gt;No&lt;br&gt;No informa&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;37&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;P1895&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;En general, qué tan satisfecho(a) se siente ...&lt;br&gt;con su vida actualmente?&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;0&lt;br&gt;1&lt;br&gt;2&lt;br&gt;3&lt;br&gt;4&lt;br&gt;5&lt;br&gt;6&lt;br&gt;7&lt;br&gt;8&lt;br&gt;9&lt;br&gt;10&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;Totalmente insatisfecho(a)&lt;br&gt;1&lt;br&gt;2&lt;br&gt;3&lt;br&gt;4&lt;br&gt;5&lt;br&gt;6&lt;br&gt;7&lt;br&gt;8&lt;br&gt;9&lt;br&gt;Totalmente satisfecho(a)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;38&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;P1896&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;En general, qué tan satisfecho(a) se siente ...&lt;br&gt;con su ingreso actualmente?&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;0&lt;br&gt;1&lt;br&gt;2&lt;br&gt;3&lt;br&gt;4&lt;br&gt;5&lt;br&gt;6&lt;br&gt;7&lt;br&gt;8&lt;br&gt;9&lt;br&gt;10&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;Totalmente insatisfecho(a)&lt;br&gt;1&lt;br&gt;2&lt;br&gt;3&lt;br&gt;4&lt;br&gt;5&lt;br&gt;6&lt;br&gt;7&lt;br&gt;8&lt;br&gt;9&lt;br&gt;Totalmente satisfecho(a)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;39&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;P1897&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;En general, qué tan satisfecho(a) se siente ...&lt;br&gt;con su salud actualmente?&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;0&lt;br&gt;1&lt;br&gt;2&lt;br&gt;3&lt;br&gt;4&lt;br&gt;5&lt;br&gt;6&lt;br&gt;7&lt;br&gt;8&lt;br&gt;9&lt;br&gt;10&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;Totalmente insatisfecho(a)&lt;br&gt;1&lt;br&gt;2&lt;br&gt;3&lt;br&gt;4&lt;br&gt;5&lt;br&gt;6&lt;br&gt;7&lt;br&gt;8&lt;br&gt;9&lt;br&gt;Totalmente satisfecho(a)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;40&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;P1898&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;En general, qué tan satisfecho(a) se siente ...&lt;br&gt;con su nivel de seguridad actualmente?&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;0&lt;br&gt;1&lt;br&gt;2&lt;br&gt;3&lt;br&gt;4&lt;br&gt;5&lt;br&gt;6&lt;br&gt;7&lt;br&gt;8&lt;br&gt;9&lt;br&gt;10&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;Totalmente insatisfecho(a)&lt;br&gt;1&lt;br&gt;2&lt;br&gt;3&lt;br&gt;4&lt;br&gt;5&lt;br&gt;6&lt;br&gt;7&lt;br&gt;8&lt;br&gt;9&lt;br&gt;Totalmente satisfecho(a)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;41&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;P1899&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;En general, qué tan satisfecho(a) se siente ...&lt;br&gt;con su trabajo/actividad actualmente?&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;0&lt;br&gt;1&lt;br&gt;2&lt;br&gt;3&lt;br&gt;4&lt;br&gt;5&lt;br&gt;6&lt;br&gt;7&lt;br&gt;8&lt;br&gt;9&lt;br&gt;10&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;Totalmente insatisfecho(a)&lt;br&gt;1&lt;br&gt;2&lt;br&gt;3&lt;br&gt;4&lt;br&gt;5&lt;br&gt;6&lt;br&gt;7&lt;br&gt;8&lt;br&gt;9&lt;br&gt;Totalmente satisfecho(a)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;42&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;P3175&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt; En general, ¿qué tan satisfecho/a se siente _____&lt;br&gt;con su tiempo libre?&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;0&lt;br&gt;1&lt;br&gt;2&lt;br&gt;3&lt;br&gt;4&lt;br&gt;5&lt;br&gt;6&lt;br&gt;7&lt;br&gt;8&lt;br&gt;9&lt;br&gt;10&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;Totalmente insatisfecho(a)&lt;br&gt;1&lt;br&gt;2&lt;br&gt;3&lt;br&gt;4&lt;br&gt;5&lt;br&gt;6&lt;br&gt;7&lt;br&gt;8&lt;br&gt;9&lt;br&gt;Totalmente satisfecho(a)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;43&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;P1901&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt; ¿qué tan feliz se sintió ... el día de ayer?&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;0&lt;br&gt;1&lt;br&gt;2&lt;br&gt;3&lt;br&gt;4&lt;br&gt;5&lt;br&gt;6&lt;br&gt;7&lt;br&gt;8&lt;br&gt;9&lt;br&gt;10&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;Para nada feliz&lt;br&gt;1&lt;br&gt;2&lt;br&gt;3&lt;br&gt;4&lt;br&gt;5&lt;br&gt;6&lt;br&gt;7&lt;br&gt;8&lt;br&gt;9&lt;br&gt;Todo el tiempo feliz&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;44&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;P1903&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;¿qué tan preocupado(a) se sintió ... el día de&lt;br&gt;ayer?&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;0&lt;br&gt;1&lt;br&gt;2&lt;br&gt;3&lt;br&gt;4&lt;br&gt;5&lt;br&gt;6&lt;br&gt;7&lt;br&gt;8&lt;br&gt;9&lt;br&gt;10&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;Para nada  preocupado(a)&lt;br&gt;1&lt;br&gt;2&lt;br&gt;3&lt;br&gt;4&lt;br&gt;5&lt;br&gt;6&lt;br&gt;7&lt;br&gt;8&lt;br&gt;9&lt;br&gt;Todo el tiempo preocupado(a)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;45&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;P1904&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;¿qué tan triste se sintió ... el día de ayer?&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;0&lt;br&gt;1&lt;br&gt;2&lt;br&gt;3&lt;br&gt;4&lt;br&gt;5&lt;br&gt;6&lt;br&gt;7&lt;br&gt;8&lt;br&gt;9&lt;br&gt;10&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;Para nada  triste&lt;br&gt;1&lt;br&gt;2&lt;br&gt;3&lt;br&gt;4&lt;br&gt;5&lt;br&gt;6&lt;br&gt;7&lt;br&gt;8&lt;br&gt;9&lt;br&gt;Todo el tiempo triste&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;46&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;P1905&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;Qué tanto considera ... que las cosas que hace en&lt;br&gt;su vida valen la pena?&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;0&lt;br&gt;1&lt;br&gt;2&lt;br&gt;3&lt;br&gt;4&lt;br&gt;5&lt;br&gt;6&lt;br&gt;7&lt;br&gt;8&lt;br&gt;9&lt;br&gt;10&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top; background-color:#eeeeee"&gt;No valen la pena&lt;br&gt;1&lt;br&gt;2&lt;br&gt;3&lt;br&gt;4&lt;br&gt;5&lt;br&gt;6&lt;br&gt;7&lt;br&gt;8&lt;br&gt;9&lt;br&gt;Valen totalmente la pena&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;47&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;P1927&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;¿En cuál escalón diría usted que se encuentra&lt;br&gt;parado(a) en este momento?&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;0&lt;br&gt;1&lt;br&gt;2&lt;br&gt;3&lt;br&gt;4&lt;br&gt;5&lt;br&gt;6&lt;br&gt;7&lt;br&gt;8&lt;br&gt;9&lt;br&gt;10&lt;/td&gt;
&lt;td style="padding:0.2cm; text-align:left; vertical-align:top;"&gt;Peor vida&lt;br&gt;1&lt;br&gt;2&lt;br&gt;3&lt;br&gt;4&lt;br&gt;5&lt;br&gt;6&lt;br&gt;7&lt;br&gt;8&lt;br&gt;9&lt;br&gt;Mejor vida&lt;/td&gt;
&lt;/tr&gt;

&lt;/table&gt;
]

???
https://www.pipinghotdata.com/posts/2020-12-23-leveraging-labelled-data-in-r/ 

Here are operations I commonly perform on labelled data:

    Evaluate if variable is of class haven_labelled.

        Why? Troubleshooting, exploring, mutating.

        Function(s): haven::is.labelled()

    Convert haven_labelled variable to numeric value codes.

        Why? To treat the variable as continuous for analysis. For example, if a 1-7 rating scale imports as labelled and you want to compute a mean.

        Function(s): base::as.numeric() (strips variable of all metadata), haven::zap_labels() and labelled::remove_val_labels (removes value labels, retains other metadata)

    Convert haven_labelled() variable to factor with value labels.

        Why? To treat the variable as categorical for analysis.

        Function(s): haven::as_factor(), labelled::to_factor(), sjlabelled::as_label(). As far as I can tell, these three functions have the same result. By default, the factor levels are ordered by value codes.

    Convert variable label to variable name.

        Why? For more informative or readable variable names.

        Function(s): sjlabelled::label_to_colnames()


---

### Search in generated data dictionnary


.left-column[


```r
# create data dictionary  
dictionary &lt;- labelled::generate_dictionary(data0)
View(dictionary)

# library(DT)
# dictionary %&gt;% 
#   DT::datatable()
```
]

--

.right-column[

<div id="htmlwidget-7f04e9456c2c825276a8" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-7f04e9456c2c825276a8">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47"],[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47],["DIRECTORIO","SECUENCIA_ENCUESTA","SECUENCIA_P","ORDEN","FEX_C","P6016","P1894","P6020","P6034","P6040","P6051","P5502","P6071","P6071S1","P756","P756S1","P756S2","P756S3","P6074","P767","P6076","P6076S1","P6076S2","P6077","P6096","P6081","P6081S1","P6087","P6083","P6083S1","P6088","P6080","P5667","P2057","P2059","P2061","P1895","P1896","P1897","P1898","P1899","P3175","P1901","P1903","P1904","P1905","P1927"],["Directorio","Secuencia_encuesta","Secuencia_p","Orden","Factor de expansión","Número de orden de la persona que proporciona la información:","Tipo de documento de identidad","Sexo","¿Cuál es la fecha de nacimiento de _____?","¿cuántos años cumplidos tiene...?","Cuál es el parentesco de....con el jefe o la jefa de este hogar?","Actualmente…:","El (la) cónyuge de .. vive en este hogar","No de orden","¿Dónde nació  ________?","Departamento","Municipio","En otro país","¿_______________ siempre ha vivido aquí en este municipio?","¿cuántos años continuos hace que vive ___ aquí en este municipio?","Antes de venir a este municipio_______________ vivía en","Departamento","Municipio\r\n","_____ vivía en","¿cuál fue la razón principal para cambiar la residencia al municipio actual?","El padre de .. vive en este hogar","No. De orden","¿cuál es o fue el nivel de educación más alto alcanzado por el padre de…..?","La madre de .. vive en este hogar","No. De orden","¿cuál es o fue el nivel de educación más alto alcanzado por la madre de......?","De acuerdo con su cultura, pueblo o rasgos físicos, _____ es o se reconoce comó:"," ¿a cuál pueblo o etnia indígena pertenece _____?","¿Usted se considera campesino(a)?"," ¿Usted considera que alguna vez fue campesino(a)?"," ¿Usted considera que la comunidad en que vive es campesina?","En general, qué tan satisfecho(a) se siente ... con su vida actualmente?","En general, qué tan satisfecho(a) se siente ... con su ingreso actualmente?","En general, qué tan satisfecho(a) se siente ... con su salud actualmente?","En general, qué tan satisfecho(a) se siente ... con su nivel de seguridad actualmente?","En general, qué tan satisfecho(a) se siente ... con su trabajo/actividad actualmente?"," En general, ¿qué tan satisfecho/a se siente _____ con su tiempo libre?"," ¿qué tan feliz se sintió ... el día de ayer?","¿qué tan preocupado(a) se sintió ... el día de ayer?","¿qué tan triste se sintió ... el día de ayer?","Qué tanto considera ... que las cosas que hace en su vida valen la pena?","¿En cuál escalón diría usted que se encuentra parado(a) en este momento?"],["dbl","dbl","dbl","dbl","dbl","dbl","dbl+lbl","dbl+lbl","dbl","dbl","dbl+lbl","dbl+lbl","dbl+lbl","dbl","dbl+lbl","dbl","dbl","dbl+lbl","dbl+lbl","dbl","dbl+lbl","chr","chr","dbl+lbl","dbl+lbl","dbl+lbl","dbl","dbl+lbl","dbl+lbl","dbl","dbl+lbl","dbl+lbl","chr","dbl+lbl","dbl+lbl","dbl+lbl","dbl+lbl","dbl+lbl","dbl+lbl","dbl+lbl","dbl+lbl","dbl+lbl","dbl+lbl","dbl+lbl","dbl+lbl","dbl+lbl","dbl+lbl"],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,[1,2,3,4,5],[1,2],null,null,[1,2,3,4,5,6,7,8,9,10,11,12,13,14],[1,2,3,4,5,6],[1,2],null,[1,2,3],null,null,[1,2,3,4,5,6,7,8,9,10,11],[1,2],null,[1,2],null,null,[1,2],[1,2,3,4,5,6,7,8,9,10,11,12],[1,2,3],null,[1,2,3,4,5,6,7,8,9,10],[1,2,3],null,[1,2,3,4,5,6,7,8,9,10],[1,2,3,4,5,6],null,[1,2,3],[1,2,3],[1,2,3],[0,1,2,3,4,5,6,7,8,9,10],[0,1,2,3,4,5,6,7,8,9,10],[0,1,2,3,4,5,6,7,8,9,10],[0,1,2,3,4,5,6,7,8,9,10],[0,1,2,3,4,5,6,7,8,9,10],[0,1,2,3,4,5,6,7,8,9,10],[0,1,2,3,4,5,6,7,8,9,10],[0,1,2,3,4,5,6,7,8,9,10],[0,1,2,3,4,5,6,7,8,9,10],[0,1,2,3,4,5,6,7,8,9,10],[0,1,2,3,4,5,6,7,8,9,10]]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>pos<\/th>\n      <th>variable<\/th>\n      <th>label<\/th>\n      <th>col_type<\/th>\n      <th>levels<\/th>\n      <th>value_labels<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":1},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>

]

???

---

### Simple plot with labelled data

.pull-left[


```r
plot &lt;- sjPlot::plot_frq(
                 data = data0$P756S3, 
                 type = "bar",
                 sort.frq =  "asc",
                 coord.flip = TRUE,
                 weight.by = as.vector(data0$FEX_C),
                 show.ci = TRUE) 
plot
```
]

--


.pull-right[

&lt;img src="presentation1_files/figure-html/unnamed-chunk-38-1.png" width="1800" /&gt;
]

---

### Style the plot
.pull-left[


```r
plot &lt;- plot + 
      scale_y_continuous(labels = scales::label_number_si()) + 
      labs(title = paste0(sjlabelled::get_label(data0$P756S3)),
           x = "", y = "",
           caption = "Source: Encusta Nacional de Calidad de Vida ECV 2020, Colombia, DANE")+
      unhcRstyle::unhcr_theme(base_size = 8)  + 
      theme(legend.position = "none",
            panel.grid.major.x  = element_line(color = "#cbcbcb"), 
            panel.grid.major.y  = element_blank(), 
            panel.grid.minor = element_blank()) 
plot
```
]

--


.pull-right[

&lt;img src="presentation1_files/figure-html/unnamed-chunk-40-1.png" width="1800" /&gt;
]

---

### Get all data files together

.pull-left[

```r
# get a list of files in a folder with specific sav extension in the data-raw folder

datasetlist &lt;- fs::dir_ls(here::here("data-raw"), 
                       glob = "*.sav")  
# head(datasetlist, 2)

# read all the files 
# all the dataset will be stored in a list object
datasets &lt;- datasetlist %&gt;% 
            map(compose(as_factor, haven::read_sav))
# class(datasets)
```
]

--

.pull-right[

```
##  Print datasetlist first 2 lines
```

```
## /home/edouard/R-projects/tested_script/SurveyAnalysisTutorial/data-raw/Atencion integral de los niños y niñas menores de 5 años.sav
## /home/edouard/R-projects/tested_script/SurveyAnalysisTutorial/data-raw/Características y composición del hogar.sav
```

```
##  Print dataset class
```

```
## [1] "list"
```
]

???
 

---

### Join data frame for Individuals

.pull-left[

```r
# Bind together datasets with the same unit of analysis
persons &lt;- datasets %&gt;% 
  # keep() is similar to Filter() but 
  # can be applied to a list object 
  ## Records available for individual are sorted with a 
  # combination of code within the sequence variable
           keep(~!all(.$SECUENCIA_P == 1) &amp;
                  !all(.$SECUENCIA_ENCUESTA == 1)) %&gt;% 
  ## Iteratively applying a binary function, i.e loop...
           reduce(
  ## Perform multiple left joins 
             full_join)

# harmonize key variables by renaming them 
# notice how SECUENCIA_ENCUESTA changes meaning between datasets
persons &lt;- persons %&gt;% 
           rename(dwelling = DIRECTORIO, 
                  household = SECUENCIA_P, 
                  person = SECUENCIA_ENCUESTA)
# nrow(persons)
# ncol(persons)
```
]

--

.pull-right[

```
## [1] 267098
```

```
## [1] 527
```
]

???
 

---

### Join data frame for Household

.pull-left[

```r
households &lt;- datasets %&gt;% 
  
  ## Records available for Household are sorted with a 
  # combination of code within the sequence variable
  
              keep(~all(.$SECUENCIA_P == 1) &amp; 
                     !all(.$SECUENCIA_ENCUESTA == 1)) %&gt;% 
              reduce(full_join)


# harmonize key variables - 
# notice how SECUENCIA_ENCUESTA changes meaning between datasets

households &lt;- households %&gt;% 
              rename(dwelling = DIRECTORIO, 
                     household = SECUENCIA_ENCUESTA) %&gt;% 
              select(-ORDEN)
# nrow(households)
#ncol(households)
```
]

--

.pull-right[

```
## [1] 88310
```

```
## [1] 235
```
]

---

### Identify Venezuelan

.pull-left[


```r
library(tidyverse)
data &lt;-  
  left_join(persons, households) %&gt;% 
  transmute(pop = case_when(is.na(P756S3) ~ "Colombians",
                            P756S3 == "Venezuela" ~ "Venezuelans",
                            TRUE ~ "Others")) 

# table(data$pop, useNA = "ifany")
```
]

--

.pull-right[

```
## 
##  Colombians      Others Venezuelans 
##      257044         496        9558
```
]

???
 
---

### Create Indicators 

.pull-left[


```r
indicators1 &lt;-   left_join(persons, households) %&gt;% 
  
  # transmute function returns the same new variable as mutate.
  # However, it does not retain our original data!
  transmute(pop = case_when(is.na(P756S3) ~ "Colombians",
                            P756S3 == "Venezuela" ~ "Venezuelans",
                            TRUE ~ "Others"),
            
    # 2.1 Proportion of PoC living below the national poverty line
            rbm2.1 = PERCAPITA &lt; 327674,
    # 2.3 Proportion of PoC with access to health services
            rbm2.3 = if_else(P5665 == "Sí", 
                             is.na(P6153), 
                             NA),
            
            dpto = "dummy", # FIXME: should be dwellings$dpto,
            wt = FEX_C)   

#knitr::kable(head(indicators1 %&gt;%
#                    select(pop, rbm2.1 )),
#             format = 'html')
```
]

--

.pull-right[
&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; pop &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; rbm2.1 &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; rbm2.3 &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Colombians &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; TRUE &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; NA &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Colombians &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; FALSE &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; NA &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Colombians &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; TRUE &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; NA &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Colombians &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; FALSE &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; NA &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Colombians &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; FALSE &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; NA &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Colombians &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; TRUE &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; NA &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
]

???

---

### Add Indicators from multiple variables

.pull-left[


```r
indicators2 &lt;-   left_join(persons, households) %&gt;% 
  transmute(pop = case_when(is.na(P756S3) ~ "Colombians",
                            P756S3 == "Venezuela" ~ "Venezuelans",
                            TRUE ~ "Others"),
            
            water = P792 != "No tienen el servicio",
            sanitation = P5032 != "No tienen el servicio",
            overcrowding = CANT_PERSONAS_HOGAR/P5000 &gt; 3,
            secure_tenure = 
              P5095 == "Propia, totalmente pagada" |
              P5095 == "Propia, lo están pagando" |
              (P5095 == "En arriendo o subarriendo" &amp; P3006 == "Escrito"),
            housing_durability = TRUE, # FIXME: correct when we get the missing data file
       
            # 2.2 Proportion of PoCs residing in physically safe and secure settlements 
            rbm2.2 = water &amp; sanitation &amp; !overcrowding &amp; housing_durability &amp; secure_tenure,
            
            dpto = "dummy", # FIXME: should be dwellings$dpto,
            wt = FEX_C)   

#knitr::kable(head(indicators %&gt;%
#                    select(pop, rbm2.2, wt )),
#             format = 'html')
```
]

--

.pull-right[
&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; pop &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; rbm2.2 &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; wt &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Colombians &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; TRUE &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 438.1767 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Colombians &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; TRUE &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 495.8612 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Colombians &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; TRUE &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 440.2299 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Colombians &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; TRUE &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 466.8462 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Colombians &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; TRUE &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 466.8462 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Colombians &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; FALSE &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 466.4742 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
]

???


 
---

### Aggregate Value

.pull-left[


```r
indicators.computed   &lt;- 
        ## get all indicators joined
        dplyr::left_join(x= indicators1,
                         y =indicators2)    %&gt;%
        ## Remove the neither colombian nor venezuelan
        filter(pop != "Others") %&gt;% 
         
        ## transform in a weighted survey object
         srvyr::as_survey_design(strata = dpto, 
                          weights = wt) %&gt;% 
         ## Compile indicators by group
         group_by(pop) %&gt;% 
         summarize(
      # Apply functions across multiple columns
           across(
           ## select all variable name based on 
           ## name pattern
             contains("rbm"), 
                          srvyr::survey_mean, 
          
             # Report variability as confidence interval ("ci")
                          vartype = "ci", 
             # missing values should be dropped
                          na.rm = TRUE,
             ## append a suffix to all column name to 
             # distinguish the mai estimation from CI
                          .names = "{.col}_est")) 
```
]


--

.pull-right[
&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; pop &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; rbm2.2_est &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; rbm2.2_est_low &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Colombians &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.5501188 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.5490104 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Venezuelans &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.2246054 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.2161841 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
]

???
 
---

### Pivot Frame

.pull-left[


```r
indicators &lt;- indicators.computed   %&gt;%
          ## pivot from wide to long using variable pop
          pivot_longer(-pop, 
                      names_to = c("ind", ".value"), 
                      names_pattern = "(.+?)_(.+)")

# Save indicators in a csv file
# write.csv(indicators, "indicators.csv")
# knitr::kable(head(indicators %&gt;%
#                    select(pop, ind, est )), format = 'html')
```
]


--

.pull-right[
&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; pop &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; ind &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; est &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Colombians &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; rbm2.1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.3027933 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Colombians &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; rbm2.2 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.5501188 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Venezuelans &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; rbm2.1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.6496214 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Venezuelans &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; rbm2.2 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.2246054 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
]

???
 

---

### Build chart

.pull-left[


```r
plot &lt;- ggplot( data = indicators,
                aes( x= est, 
                     y = fct_rev(ind))) +
  geom_pointrange(aes(xmin = est_low, 
                      xmax = est_upp, 
                      color = pop), 
                       size = .75) +
  geom_text(aes(label = scales::label_percent(.1)(est)), 
                 vjust = -1.25) 
plot
```
]

--

.pull-right[
&lt;img src="presentation1_files/figure-html/unnamed-chunk-58-1.png" width="1080" /&gt;
]

???


---

### Add scale

.pull-left[


```r
plot &lt;- plot +
  scale_x_continuous(labels = scales::label_percent(), 
                     limits = c(0, 1), 
                     breaks = c(0, .5, 1)) +
  scale_color_manual(values = c(Colombians = "black", Venezuelans = "#0072BC")) 

plot
```
]

--

.pull-right[
&lt;img src="presentation1_files/figure-html/unnamed-chunk-60-1.png" width="1080" /&gt;
]

???



---

### Change labels

.pull-left[


```r
## Add labels for each calculated indicators
rbm_indicators &lt;- 
  c(rbm2.1 = "2.1 Proportion of PoC living below the national poverty line",
    rbm2.2 = "2.2 Proportion of PoCs residing in physically safe and secure settlements with access to basic facilities.",
    rbm2.3 = "2.3 Proportion of PoC with access to health services")

plot &lt;- plot +
  scale_y_discrete(labels = str_wrap(rev(rbm_indicators), 40)) 
plot
```
]

--

.pull-right[
&lt;img src="presentation1_files/figure-html/unnamed-chunk-62-1.png" width="1080" /&gt;
]

???


---

### Title and Style

.pull-left[


```r
plot &lt;- plot + 
 labs(x = "Estimate", y = "",
       title = "Impact Area 2: Realizing Rights in Safe Environments",
       caption = glue::glue("Encuesta Nacional de Calidad de Vida (ECV) 2020\n",
                            "# of Venezuelans = {scales::label_comma()(sum(data$pop=='Venezuelans'))} obs. ",
                            "({scales::label_number_si(.1)(sum((data$pop=='Venezuelans')*data$wt))} weighted)")) +
  unhcRstyle::unhcr_theme() +
  theme(panel.grid.minor.x = element_blank())

plot
```
]

--

.pull-right[
&lt;img src="presentation1_files/figure-html/unnamed-chunk-64-1.png" width="1080" /&gt;
]

???

---

## Congrat!

Today you learn the basics! 

 * Objects are __words__
 * Functions are __verbs__ used to transform object
 * Charts are  __complement__ created with the __grammar__ of graphics

???

In grammar, a complement is a word, phrase, or clause that is necessary to complete the meaning of a given expression. Complements are often also arguments 

---
class: center, middle, inverse


# Practical Use Case 3 - Evidence for key research question

### * What programmatic assumptions do we have evidences for? Describe, Explore, Explain...  *  &lt;i class="fa fa-eye fa-fw fa-2x"&gt;&lt;/i&gt; 


---

## Statistical association analysis: Crosstabulation &amp; Assocation


&gt; __Question__: How is the perception of current situation compared to that of 5 years ago differs between the "undocumented Venezuelans" and the rest of the population? 
 
See you in the R master webinar in January !


???

---

## Regression analysis between a target variable and multiple predictors
&gt; __Question__: What can explain why some "undocumented Venezuelans" feel worse now than five years ago? 
 
See you in the R master webinar in January !

---

## Clustering analysis to identify a homogeneous group of individuals based on multiple variables

&gt; __Question__: What are the main profiles of "undocumented Venezuelans" who have a worse situation now than 5 years ago? 
  
 
See you in the R master webinar in February !   

---
class: left, top

# Good luck in your R journey!

### Reach out to us for questions, analysis mentoring or code peer review!


.pull-left[

__DIMA Americas__: &lt;br&gt;
Edouard Legoupil, _Snr Statistics &amp; Data Analysis Officer_,&lt;br&gt;  &lt;a href="mailto:legoupil@unhcr.org"&gt;&lt;i class="fa fa-paper-plane fa-fw"&gt;&lt;/i&gt;&amp;nbsp; legoupil@unhcr.org&lt;/a&gt;  &lt;br&gt; 
Hisham Galal, _Associate Statistics &amp; Data Analysis Officer_,&lt;br&gt;  &lt;a href="mailto:galal@unhcr.org"&gt;&lt;i class="fa fa-paper-plane fa-fw"&gt;&lt;/i&gt;&amp;nbsp; galal@unhcr.org&lt;/a&gt;


Check our github @ &lt;a href="http://github.com/unhcr-americas"&gt;&lt;i class="fa fa-github fa-fw"&gt;&lt;/i&gt;&amp;nbsp;unhcr-americas&lt;/a&gt;  and learn about __UnhcRverse packages__&lt;br&gt;

Slides created with [**remark.js**](http://remarkjs.com/) and the R package [**xaringan**](https://github.com/yihui/xaringan). Slides notes for this presentation can be displayed by pressing keyboard shortcut `p` - Navigation help with keyboard shortcut `h`


]

.pull-right[

&lt;img src="images/giphy.gif" width="310px"/&gt;

]


???



Last, we hope that this session will motivate you to join the vibrant R users community in UNHCR and soon become an R champion. In order to make the most of the session, we would advise you to install the following open source environment: 

    R - https://cran.r-project.org/bin/windows/base/ 

    Rstudio Free version: https://www.rstudio.com/products/rstudio/download/ 

    Create an account on Github - https://github.com/join?  and install Github desktop https://desktop.github.com/ 

You may also start installing UNHCR Packages – following the instruction in their respective documentation published on Github: 

    Use UNHCR Open data  - https://unhcr.github.io/unhcrdatapackage/docs/  

    API to connect to internal data source - https://unhcr-web.github.io/hcrdata/docs/ 

    Perform High Frequency Check https://unhcr.github.io/HighFrequencyChecks/docs/ 

    Process data crunching for survey dataset - https://unhcr.github.io/koboloadeR/docs/  

    Use UNHCR graphical template- https://unhcr-web.github.io/unhcRstyle/docs/ 

See some practical tutorial on https://humanitarian-user-group.github.io/  

The best way to start and learn is to have a concrete project! If you have one and need mentoring, we can liaise after the session. 

Resources Ggplot:

- [Ggplot main doc](https://ggplot2.tidyverse.org/index.html)
- [The ggplot flipbook](https://evamaerey.github.io/ggplot_flipbook/ggplot_flipbook_xaringan.html#1) by Gina Reynolds
- [A ggplot2 tutorial for beautiful plotting in R](https://www.cedricscherer.com/2019/08/05/a-ggplot2-tutorial-for-beautiful-plotting-in-r/) and [ggplot Wizardry Hands-On](https://z3tt.github.io/OutlierConf2021/) by Cedric Scherer
- Ggplot workshop [Part1](https://www.youtube.com/watch?v=h29g21z0a68)/[Part2](https://www.youtube.com/watch?v=0m4yywqNPVY) by Thomas Lin Pedersen (one of the main maintainer of ggplot)


 
 packages extension for ggplot

- Patchwork to bind multiple plots on one

- Gganimate to create simple animation

- Ggtext and ggrepel to deal with annotation and text style

- Ggforce to group some content visually

- and much more.... just go out there and experiment


    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
